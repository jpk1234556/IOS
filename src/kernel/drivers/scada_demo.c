/* scada_demo.c - Brandon Media OS SCADA Demo Interface
 * Neural Control Panel with 3D Parallax Effects
 */

#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>
#include <string.h>
#include "kernel/gui.h"
#include "kernel/framebuffer.h"
#include "kernel/memory.h"

/* External functions */
extern void serial_puts(const char *s);
extern uint32_t get_time_ms(void);

/* SCADA Demo State */
typedef struct {
    gui_widget_t *main_panel;
    gui_widget_t *status_panel;
    gui_widget_t *control_panel;
    
    /* Gauges */
    gui_widget_t *temperature_gauge;
    gui_widget_t *pressure_gauge;
    gui_widget_t *flow_gauge;
    gui_widget_t *power_gauge;
    
    /* Progress bars */
    gui_widget_t *system_load;
    gui_widget_t *memory_usage;
    gui_widget_t *network_activity;
    
    /* Controls */
    gui_widget_t *start_button;
    gui_widget_t *stop_button;
    gui_widget_t *reset_button;
    gui_widget_t *emergency_stop;
    
    /* Neural matrix background */
    gui_widget_t *matrix_bg;
    
    /* Labels */
    gui_widget_t *title_label;
    gui_widget_t *status_label;
    
    /* System state */
    bool system_running;
    float simulation_time;
    uint32_t last_update;
} scada_demo_t;

static scada_demo_t scada_demo;

/* Forward declarations */
static void update_scada_simulation(void);
static void on_start_button_click(gui_widget_t *widget);
static void on_stop_button_click(gui_widget_t *widget);
static void on_reset_button_click(gui_widget_t *widget);
static void on_emergency_stop_click(gui_widget_t *widget);

/* Initialize SCADA Demo Interface */
void scada_demo_init(void) {
    serial_puts(\"[SCADA-DEMO] Initializing Neural SCADA Interface...\\n\");\n    \n    /* Clear demo state */\n    memset(&scada_demo, 0, sizeof(scada_demo_t));\n    \n    /* Get framebuffer dimensions */\n    framebuffer_device_t *fb = framebuffer_get_device();\n    if (!fb) {\n        serial_puts(\"[ERROR] No framebuffer available for SCADA interface\\n\");\n        return;\n    }\n    \n    int32_t screen_width = fb->width;\n    int32_t screen_height = fb->height;\n    \n    /* Create neural matrix background */\n    rect_t matrix_rect = {0, 0, screen_width, screen_height};\n    scada_demo.matrix_bg = gui_create_neural_matrix(\"matrix_bg\", matrix_rect, 20, 15);\n    if (scada_demo.matrix_bg) {\n        gui_add_widget(scada_demo.matrix_bg);\n    }\n    \n    /* Create main panel (center) */\n    rect_t main_panel_rect = {screen_width / 4, screen_height / 8, screen_width / 2, 3 * screen_height / 4};\n    color_rgba_t panel_color = {0x00, 0x20, 0x40, 0xB0}; /* Semi-transparent dark blue */\n    scada_demo.main_panel = gui_create_panel(\"main_panel\", main_panel_rect, panel_color);\n    if (scada_demo.main_panel) {\n        gui_add_widget(scada_demo.main_panel);\n    }\n    \n    /* Create title label */\n    rect_t title_rect = {main_panel_rect.x + 20, main_panel_rect.y + 10, 300, 30};\n    scada_demo.title_label = gui_create_label(\"title\", title_rect, \"NEURAL SCADA CONTROL SYSTEM\");\n    if (scada_demo.title_label) {\n        gui_add_widget(scada_demo.title_label);\n    }\n    \n    /* Create status panel (top right) */\n    rect_t status_panel_rect = {main_panel_rect.x + 20, main_panel_rect.y + 50, main_panel_rect.width - 40, 60};\n    color_rgba_t status_color = {0x00, 0x40, 0x00, 0x80}; /* Semi-transparent green */\n    scada_demo.status_panel = gui_create_panel(\"status_panel\", status_panel_rect, status_color);\n    if (scada_demo.status_panel) {\n        gui_add_widget(scada_demo.status_panel);\n    }\n    \n    /* Create status label */\n    rect_t status_label_rect = {status_panel_rect.x + 10, status_panel_rect.y + 20, 200, 20};\n    scada_demo.status_label = gui_create_label(\"status\", status_label_rect, \"SYSTEM: OFFLINE\");\n    if (scada_demo.status_label) {\n        gui_add_widget(scada_demo.status_label);\n    }\n    \n    /* Create gauges in a 2x2 grid */\n    int32_t gauge_size = 120;\n    int32_t gauge_spacing = 140;\n    int32_t gauge_start_x = main_panel_rect.x + 40;\n    int32_t gauge_start_y = main_panel_rect.y + 130;\n    \n    /* Temperature gauge (top-left) */\n    rect_t temp_gauge_rect = {gauge_start_x, gauge_start_y, gauge_size, gauge_size};\n    scada_demo.temperature_gauge = gui_create_scada_gauge(\"temp_gauge\", temp_gauge_rect, 0.0f, 100.0f, \"Â°C\");\n    if (scada_demo.temperature_gauge) {\n        gui_add_widget(scada_demo.temperature_gauge);\n    }\n    \n    /* Pressure gauge (top-right) */\n    rect_t pressure_gauge_rect = {gauge_start_x + gauge_spacing, gauge_start_y, gauge_size, gauge_size};\n    scada_demo.pressure_gauge = gui_create_scada_gauge(\"pressure_gauge\", pressure_gauge_rect, 0.0f, 50.0f, \"PSI\");\n    if (scada_demo.pressure_gauge) {\n        gui_add_widget(scada_demo.pressure_gauge);\n    }\n    \n    /* Flow gauge (bottom-left) */\n    rect_t flow_gauge_rect = {gauge_start_x, gauge_start_y + gauge_spacing, gauge_size, gauge_size};\n    scada_demo.flow_gauge = gui_create_scada_gauge(\"flow_gauge\", flow_gauge_rect, 0.0f, 200.0f, \"L/m\");\n    if (scada_demo.flow_gauge) {\n        gui_add_widget(scada_demo.flow_gauge);\n    }\n    \n    /* Power gauge (bottom-right) */\n    rect_t power_gauge_rect = {gauge_start_x + gauge_spacing, gauge_start_y + gauge_spacing, gauge_size, gauge_size};\n    scada_demo.power_gauge = gui_create_scada_gauge(\"power_gauge\", power_gauge_rect, 0.0f, 1000.0f, \"kW\");\n    if (scada_demo.power_gauge) {\n        gui_add_widget(scada_demo.power_gauge);\n    }\n    \n    /* Create progress bars */\n    int32_t progress_start_y = main_panel_rect.y + main_panel_rect.height - 180;\n    int32_t progress_width = (main_panel_rect.width - 80) / 3;\n    \n    /* System load progress bar */\n    rect_t system_load_rect = {main_panel_rect.x + 20, progress_start_y, progress_width, 25};\n    scada_demo.system_load = gui_create_progress_bar(\"system_load\", system_load_rect, \"CPU Load\");\n    if (scada_demo.system_load) {\n        gui_add_widget(scada_demo.system_load);\n    }\n    \n    /* Memory usage progress bar */\n    rect_t memory_usage_rect = {main_panel_rect.x + 30 + progress_width, progress_start_y, progress_width, 25};\n    scada_demo.memory_usage = gui_create_progress_bar(\"memory_usage\", memory_usage_rect, \"Memory\");\n    if (scada_demo.memory_usage) {\n        gui_add_widget(scada_demo.memory_usage);\n    }\n    \n    /* Network activity progress bar */\n    rect_t network_activity_rect = {main_panel_rect.x + 40 + 2 * progress_width, progress_start_y, progress_width, 25};\n    scada_demo.network_activity = gui_create_progress_bar(\"network_activity\", network_activity_rect, \"Network\");\n    if (scada_demo.network_activity) {\n        gui_add_widget(scada_demo.network_activity);\n    }\n    \n    /* Create control buttons */\n    int32_t button_y = main_panel_rect.y + main_panel_rect.height - 120;\n    int32_t button_width = 80;\n    int32_t button_height = 35;\n    int32_t button_spacing = 90;\n    \n    /* Start button */\n    rect_t start_button_rect = {main_panel_rect.x + 20, button_y, button_width, button_height};\n    scada_demo.start_button = gui_create_button(\"start_btn\", start_button_rect, \"START\", on_start_button_click);\n    if (scada_demo.start_button) {\n        gui_add_widget(scada_demo.start_button);\n    }\n    \n    /* Stop button */\n    rect_t stop_button_rect = {main_panel_rect.x + 20 + button_spacing, button_y, button_width, button_height};\n    scada_demo.stop_button = gui_create_button(\"stop_btn\", stop_button_rect, \"STOP\", on_stop_button_click);\n    if (scada_demo.stop_button) {\n        gui_add_widget(scada_demo.stop_button);\n    }\n    \n    /* Reset button */\n    rect_t reset_button_rect = {main_panel_rect.x + 20 + 2 * button_spacing, button_y, button_width, button_height};\n    scada_demo.reset_button = gui_create_button(\"reset_btn\", reset_button_rect, \"RESET\", on_reset_button_click);\n    if (scada_demo.reset_button) {\n        gui_add_widget(scada_demo.reset_button);\n    }\n    \n    /* Emergency stop button (larger, red) */\n    rect_t emergency_rect = {main_panel_rect.x + main_panel_rect.width - 100, button_y - 10, 80, 55};\n    scada_demo.emergency_stop = gui_create_button(\"emergency\", emergency_rect, \"EMRG\\nSTOP\", on_emergency_stop_click);\n    if (scada_demo.emergency_stop) {\n        scada_demo.emergency_stop->bg_color = (color_rgba_t)GUI_COLOR_NEURAL_RED;\n        gui_add_widget(scada_demo.emergency_stop);\n    }\n    \n    /* Initialize simulation state */\n    scada_demo.system_running = false;\n    scada_demo.simulation_time = 0.0f;\n    scada_demo.last_update = get_time_ms();\n    \n    serial_puts(\"[SUCCESS] Neural SCADA Interface initialized\\n\");\n}\n\n/* Update SCADA Demo */\nvoid scada_demo_update(void) {\n    uint32_t current_time = get_time_ms();\n    uint32_t delta_ms = current_time - scada_demo.last_update;\n    scada_demo.last_update = current_time;\n    \n    if (scada_demo.system_running) {\n        scada_demo.simulation_time += delta_ms / 1000.0f;\n        update_scada_simulation();\n    }\n}\n\n/* Update simulation values */\nstatic void update_scada_simulation(void) {\n    float time = scada_demo.simulation_time;\n    \n    /* Generate realistic simulation data */\n    float temperature = 20.0f + 30.0f * (0.5f + 0.5f * sinf(time * 0.1f));\n    float pressure = 15.0f + 10.0f * (0.5f + 0.5f * cosf(time * 0.15f));\n    float flow = 50.0f + 50.0f * (0.5f + 0.5f * sinf(time * 0.08f + 1.0f));\n    float power = 300.0f + 200.0f * (0.5f + 0.5f * cosf(time * 0.12f + 0.5f));\n    \n    /* Update gauges */\n    gui_update_gauge_value(scada_demo.temperature_gauge, temperature);\n    gui_update_gauge_value(scada_demo.pressure_gauge, pressure);\n    gui_update_gauge_value(scada_demo.flow_gauge, flow);\n    gui_update_gauge_value(scada_demo.power_gauge, power);\n    \n    /* Set alarms for critical values */\n    gui_set_gauge_alarm(scada_demo.temperature_gauge, temperature > 80.0f);\n    gui_set_gauge_alarm(scada_demo.pressure_gauge, pressure > 40.0f);\n    \n    /* Update progress bars */\n    float cpu_load = 0.3f + 0.4f * (0.5f + 0.5f * sinf(time * 0.2f));\n    float memory_usage = 0.6f + 0.2f * (0.5f + 0.5f * cosf(time * 0.18f));\n    float network_activity = 0.1f + 0.6f * (0.5f + 0.5f * sinf(time * 0.25f + 2.0f));\n    \n    extern void gui_set_progress_value(gui_widget_t *progress_bar, float value);\n    gui_set_progress_value(scada_demo.system_load, cpu_load);\n    gui_set_progress_value(scada_demo.memory_usage, memory_usage);\n    gui_set_progress_value(scada_demo.network_activity, network_activity);\n}\n\n/* Button event handlers */\nstatic void on_start_button_click(gui_widget_t *widget) {\n    serial_puts(\"[SCADA] START button pressed\\n\");\n    scada_demo.system_running = true;\n    \n    /* Update status label */\n    if (scada_demo.status_label && scada_demo.status_label->data) {\n        label_data_t *label_data = (label_data_t *)scada_demo.status_label->data;\n        strcpy(label_data->text, \"SYSTEM: ONLINE - RUNNING\");\n        scada_demo.status_label->color = (color_rgba_t)GUI_COLOR_NEURAL_GREEN;\n    }\n}\n\nstatic void on_stop_button_click(gui_widget_t *widget) {\n    serial_puts(\"[SCADA] STOP button pressed\\n\");\n    scada_demo.system_running = false;\n    \n    /* Update status label */\n    if (scada_demo.status_label && scada_demo.status_label->data) {\n        label_data_t *label_data = (label_data_t *)scada_demo.status_label->data;\n        strcpy(label_data->text, \"SYSTEM: OFFLINE - STOPPED\");\n        scada_demo.status_label->color = (color_rgba_t)GUI_COLOR_NEURAL_WHITE;\n    }\n}\n\nstatic void on_reset_button_click(gui_widget_t *widget) {\n    serial_puts(\"[SCADA] RESET button pressed\\n\");\n    scada_demo.system_running = false;\n    scada_demo.simulation_time = 0.0f;\n    \n    /* Reset all gauges to zero */\n    gui_update_gauge_value(scada_demo.temperature_gauge, 0.0f);\n    gui_update_gauge_value(scada_demo.pressure_gauge, 0.0f);\n    gui_update_gauge_value(scada_demo.flow_gauge, 0.0f);\n    gui_update_gauge_value(scada_demo.power_gauge, 0.0f);\n    \n    /* Reset progress bars */\n    extern void gui_set_progress_value(gui_widget_t *progress_bar, float value);\n    gui_set_progress_value(scada_demo.system_load, 0.0f);\n    gui_set_progress_value(scada_demo.memory_usage, 0.0f);\n    gui_set_progress_value(scada_demo.network_activity, 0.0f);\n    \n    /* Update status label */\n    if (scada_demo.status_label && scada_demo.status_label->data) {\n        label_data_t *label_data = (label_data_t *)scada_demo.status_label->data;\n        strcpy(label_data->text, \"SYSTEM: RESET - READY\");\n        scada_demo.status_label->color = (color_rgba_t)GUI_COLOR_NEURAL_CYAN;\n    }\n}\n\nstatic void on_emergency_stop_click(gui_widget_t *widget) {\n    serial_puts(\"[SCADA] EMERGENCY STOP activated!\\n\");\n    scada_demo.system_running = false;\n    \n    /* Set all alarms */\n    gui_set_gauge_alarm(scada_demo.temperature_gauge, true);\n    gui_set_gauge_alarm(scada_demo.pressure_gauge, true);\n    gui_set_gauge_alarm(scada_demo.flow_gauge, true);\n    gui_set_gauge_alarm(scada_demo.power_gauge, true);\n    \n    /* Update status label */\n    if (scada_demo.status_label && scada_demo.status_label->data) {\n        label_data_t *label_data = (label_data_t *)scada_demo.status_label->data;\n        strcpy(label_data->text, \"EMERGENCY STOP - SYSTEM HALTED\");\n        scada_demo.status_label->color = (color_rgba_t)GUI_COLOR_NEURAL_RED;\n    }\n}", "original_text": "/* scada_demo.c - Brandon Media OS SCADA Demo Interface\n * Neural Control Panel with 3D Parallax Effects\n */\n\n#include <stdint.h>\n#include <stdbool.h>\n#include <stddef.h>\n#include <string.h>\n#include \"kernel/gui.h\"\n#include \"kernel/framebuffer.h\"\n#include \"kernel/memory.h\"\n\n/* External functions */\nextern void serial_puts(const char *s);\nextern uint32_t get_time_ms(void);\n\n/* SCADA Demo State */\ntypedef struct {\n    gui_widget_t *main_panel;\n    gui_widget_t *status_panel;\n    gui_widget_t *control_panel;\n    \n    /* Gauges */\n    gui_widget_t *temperature_gauge;\n    gui_widget_t *pressure_gauge;\n    gui_widget_t *flow_gauge;\n    gui_widget_t *power_gauge;\n    \n    /* Progress bars */\n    gui_widget_t *system_load;\n    gui_widget_t *memory_usage;\n    gui_widget_t *network_activity;\n    \n    /* Controls */\n    gui_widget_t *start_button;\n    gui_widget_t *stop_button;\n    gui_widget_t *reset_button;\n    gui_widget_t *emergency_stop;\n    \n    /* Neural matrix background */\n    gui_widget_t *matrix_bg;\n    \n    /* Labels */\n    gui_widget_t *title_label;\n    gui_widget_t *status_label;\n    \n    /* System state */\n    bool system_running;\n    float simulation_time;\n    uint32_t last_update;\n} scada_demo_t;\n\nstatic scada_demo_t scada_demo;\n\n/* Forward declarations */\nstatic void update_scada_simulation(void);\nstatic void on_start_button_click(gui_widget_t *widget);\nstatic void on_stop_button_click(gui_widget_t *widget);\nstatic void on_reset_button_click(gui_widget_t *widget);\nstatic void on_emergency_stop_click(gui_widget_t *widget);\n\n/* Initialize SCADA Demo Interface */\nvoid scada_demo_init(void) {\n    serial_puts(\"[SCADA-DEMO] Initializing Neural SCADA Interface...\\n\");"}